# Issue: –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≥—Ä—É–ø–ø—ã

## –°—Ç–∞—Ç—É—Å
üî¥ **–û—Ç–∫—Ä—ã—Ç–æ** - –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
üî¥ **–í—ã—Å–æ–∫–∏–π** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, –±–ª–æ–∫–∏—Ä—É—é—â–∞—è —Ä–∞–±–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≥—Ä—É–ø–ø—ã

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≥—Ä—É–ø–ø—ã (`/grades/[gradeId]`) –≤–æ–∑–Ω–∏–∫–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ –æ—à–∏–±–∫–∏:

1. **"No current user"** - –æ—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤
2. **"Rate exceeded"** - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ AWS AppSync
3. –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

### –õ–æ–≥–∏ –æ—à–∏–±–æ–∫

```
Error getting grade with full data: Error [DataAccessError]: No current user
    at parseError (src\lib\db\errors.ts:233:12)
    at executeGraphQL (src\lib\db\amplify.ts:82:11)
    at async getLessonGoldenVersesByLesson (src\lib\db\queries.ts:393:18)
    at async eval (actions\grades.ts:680:38)
    at async getGradeWithFullDataAction (actions\grades.ts:669:51)
    at async GradeDetailPage (src\app\(private)\grades\[gradeId]\page.tsx:40:23)

underlyingError: TooManyRequestsException: Rate exceeded
    at async executeGraphQL (src\lib\db\amplify.ts:49:20)
    at async getLessonGoldenVersesByLesson (src\lib\db\queries.ts:393:18)
```

## –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞

**Next.js App Router –∏ cookies()**:
- `cookies()` –∏–∑ `next/headers` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `Promise.all` –≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–ø—Ä–æ—Å–∞
- –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ `getClient()` —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ `generateServerClientUsingCookies`
- –ï—Å–ª–∏ `cookies` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è, –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º**:
- –í `getClient()` —Ñ—É–Ω–∫—Ü–∏—è `cookies` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é: `cookies` (—ç—Ç–æ —É–∂–µ —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ –∏–º–ø–æ—Ä—Ç–∞)
- `generateServerClientUsingCookies` –æ–∂–∏–¥–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `() => ReadonlyRequestCookies`
- –ü—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö —á–µ—Ä–µ–∑ `Promise.all`, –∫–∞–∂–¥—ã–π –ø—Ä–æ–º–∏—Å —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–π –∫–ª–∏–µ–Ω—Ç
- –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç cookies —Ç–µ—Ä—è–µ—Ç—Å—è –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏, –∫–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞ AWS Amplify Gen 1**:
- `generateServerClientUsingCookies` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç cookies –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤ (idToken, accessToken)
- –¢–æ–∫–µ–Ω—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ cookies —Å –∏–º–µ–Ω–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ Amplify –æ–∂–∏–¥–∞–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `cognito-id-token`, `cognito-access-token`)
- –ü—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å race condition –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ cookies

#### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–¥–µ

```typescript
// actions/grades.ts, —Å—Ç—Ä–æ–∫–∞ 669
const lessonsWithStats: LessonWithStats[] = await Promise.all(
  lessons.map(async (lesson) => {
    // –ö–∞–∂–¥—ã–π –ø—Ä–æ–º–∏—Å —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ executeGraphQL -> getClient()
    const goldenVersesResult = await getLessonGoldenVersesByLesson(lesson.id);
    // –ï—Å–ª–∏ 10 —É—Ä–æ–∫–æ–≤, —Ç–æ 10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–∞–∂–¥—ã–π —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–π –∫–ª–∏–µ–Ω—Ç
    // –ü—Ä–∏ —ç—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç cookies –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω
  })
);
```

### 2. –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ AppSync

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–õ–∏–º–∏—Ç—ã AWS AppSync**:
- AWS AppSync –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É (RPS - Requests Per Second)
- –î–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ tier: ~1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ `TooManyRequestsException: Rate exceeded`
- –õ–∏–º–∏—Ç—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ API endpoint

**–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏**:
- –í `getGradeWithFullDataAction` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞ –¥–µ–ª–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤:
  - `getLessonsByAcademicYear` - 1 –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—Å–µ —É—Ä–æ–∫–∏
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞:
    - `getHomeworkChecksByLesson` - 1 –∑–∞–ø—Ä–æ—Å
    - `getLessonGoldenVersesByLesson` - 1 –∑–∞–ø—Ä–æ—Å
    - –î–ª—è –∫–∞–∂–¥–æ–≥–æ golden verse: `getGoldenVerse` - N –∑–∞–ø—Ä–æ—Å–æ–≤
- –ï—Å–ª–∏ –≤ –≥—Ä—É–ø–ø–µ 10 —É—Ä–æ–∫–æ–≤, –∏ —É –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞ 3 golden verses:
  - 1 –∑–∞–ø—Ä–æ—Å (—É—Ä–æ–∫–∏) + 10 –∑–∞–ø—Ä–æ—Å–æ–≤ (homework checks) + 10 –∑–∞–ø—Ä–æ—Å–æ–≤ (golden verses) + 30 –∑–∞–ø—Ä–æ—Å–æ–≤ (golden verse details) = **51 –∑–∞–ø—Ä–æ—Å**
- –í—Å–µ —ç—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ `Promise.all`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç AppSync

**–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting**:
- –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ—Ç retry –ª–æ–≥–∏–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ "Rate exceeded"
- –ù–µ—Ç –±–∞—Ç—á–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

#### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã

```typescript
// actions/grades.ts
// –ï—Å–ª–∏ –≤ –≥—Ä—É–ø–ø–µ 20 —É—Ä–æ–∫–æ–≤, –∏ –∫–∞–∂–¥—ã–π —É—Ä–æ–∫ –∏–º–µ–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
// 20 —É—Ä–æ–∫–æ–≤ √ó (1 homework check + 1 golden verses + 3 golden verse details) = 100+ –∑–∞–ø—Ä–æ—Å–æ–≤
// –í—Å–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ Promise.all
// AppSync –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å "Rate exceeded" –µ—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω
```

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –¶–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤

1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞**: `src/app/(private)/grades/[gradeId]/page.tsx`
   - –í—ã–∑—ã–≤–∞–µ—Ç `getGradeWithFullDataAction({ id: gradeId })`

2. **Server Action**: `actions/grades.ts` ‚Üí `getGradeWithFullDataAction()`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –í—ã–∑–æ–≤ `getGradeWithRelations(id)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø—ã
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–µ–±–Ω–æ–≥–æ –≥–æ–¥–∞:
     - –í—ã–∑–æ–≤ `getLessonsByAcademicYear(academicYearId)`
     - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞ (—á–µ—Ä–µ–∑ `Promise.all`):
       - `getHomeworkChecksByLesson(lessonId)`
       - `getLessonGoldenVersesByLesson(lessonId)`
       - –î–ª—è –∫–∞–∂–¥–æ–≥–æ golden verse: `getGoldenVerse(goldenVerseId)`

3. **Data Access Layer**: `src/lib/db/queries.ts`
   - –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ GraphQL –∑–∞–ø—Ä–æ—Å—ã
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç `executeGraphQL` –∏–∑ `src/lib/db/amplify.ts`

4. **GraphQL Client**: `src/lib/db/amplify.ts`
   - `executeGraphQL()` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç GraphQL –∑–∞–ø—Ä–æ—Å—ã
   - `getClient()` - —Å–æ–∑–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ `generateServerClientUsingCookies`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç cookies –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

–î–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≥—Ä—É–ø–ø—ã —Å:
- 1 –≥—Ä—É–ø–ø–æ–π
- 2 —É—á–µ–±–Ω—ã–º–∏ –≥–æ–¥–∞–º–∏
- 10 —É—Ä–æ–∫–∞–º–∏ –≤ –∫–∞–∂–¥–æ–º –≥–æ–¥—É (20 —É—Ä–æ–∫–æ–≤ –≤—Å–µ–≥–æ)
- 3 golden verses –Ω–∞ —É—Ä–æ–∫
- 5 —É—á–µ–Ω–∏–∫–æ–≤

**–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤**:
- 1 –∑–∞–ø—Ä–æ—Å: `getGrade(gradeId)`
- 1 –∑–∞–ø—Ä–æ—Å: `getPupilsByGrade(gradeId)`
- 1 –∑–∞–ø—Ä–æ—Å: `getAcademicYearsByGrade(gradeId)`
- 1 –∑–∞–ø—Ä–æ—Å: `getGradeSettingsByGrade(gradeId)`
- 1 –∑–∞–ø—Ä–æ—Å: `getGradeEventsByGrade(gradeId)`
- 1 –∑–∞–ø—Ä–æ—Å: `getUserGradesByGradeId(gradeId)` (–¥–ª—è —É—á–∏—Ç–µ–ª–µ–π)
- N –∑–∞–ø—Ä–æ—Å–æ–≤: `getUser(userId)` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∏—Ç–µ–ª—è
- 2 –∑–∞–ø—Ä–æ—Å–∞: `getLessonsByAcademicYear()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–µ–±–Ω–æ–≥–æ –≥–æ–¥–∞
- 20 –∑–∞–ø—Ä–æ—Å–æ–≤: `getHomeworkChecksByLesson()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞
- 20 –∑–∞–ø—Ä–æ—Å–æ–≤: `getLessonGoldenVersesByLesson()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞
- 60 –∑–∞–ø—Ä–æ—Å–æ–≤: `getGoldenVerse()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ golden verse (20 —É—Ä–æ–∫–æ–≤ √ó 3 verses)

**–ò—Ç–æ–≥–æ: ~108 –∑–∞–ø—Ä–æ—Å–æ–≤**, –≤—Å–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ `Promise.all`

## –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è MVP)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —É—Ä–æ–∫–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –°–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç –ª–∏–º–∏—Ç
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è MVP
- ‚úÖ –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –ø–æ—Ç–µ—Ä–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –≤—Å–µ–≥–æ (–ª–∏–Ω–µ–π–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
- ‚ö†Ô∏è –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```typescript
const lessonsWithStats: LessonWithStats[] = [];
for (const lesson of lessons) {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —É—Ä–æ–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º
  const homeworkChecksResult = await getHomeworkChecksByLesson(lesson.id);
  const goldenVersesResult = await getLessonGoldenVersesByLesson(lesson.id);
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
  lessonsWithStats.push(processedLesson);
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ AppSync.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`p-limit`)
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º –ø–æ–ª–Ω—ã–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```typescript
import pLimit from 'p-limit';
const limit = pLimit(5); // –ú–∞–∫—Å–∏–º—É–º 5 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

const lessonsWithStats = await Promise.all(
  lessons.map(lesson => 
    limit(async () => {
      // –ó–∞–ø—Ä–æ—Å—ã –∫ AppSync
    })
  )
);
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ë–∞—Ç—á–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–∏–Ω GraphQL –∑–∞–ø—Ä–æ—Å.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ AppSync
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –º–Ω–æ–≥–∏—Ö)
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è GraphQL —Å—Ö–µ–º—ã –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ö†Ô∏è –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è MVP

### –í–∞—Ä–∏–∞–Ω—Ç 4: Retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

**–û–ø–∏—Å–∞–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –¥–ª—è –æ—à–∏–±–æ–∫ "Rate exceeded".

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π –ª–∏–º–∏—Ç–∞
- ‚úÖ –£–ª—É—á—à–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ö†Ô∏è –ù–µ —Ä–µ—à–∞–µ—Ç –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```typescript
async function executeGraphQLWithRetry<T>(...args) {
  let lastError;
  for (let attempt = 0; attempt < 3; attempt++) {
    try {
      return await executeGraphQL<T>(...args);
    } catch (error) {
      if (error.message.includes('Rate exceeded')) {
        await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));
        lastError = error;
        continue;
      }
      throw error;
    }
  }
  throw lastError;
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 5: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ + retry –ª–æ–≥–∏–∫–∞.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `p-limit` –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ (5-10 –∑–∞–ø—Ä–æ—Å–æ–≤)
2. –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π –ª–∏–º–∏—Ç–∞
3. –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é
- ‚úÖ –†–µ—à–∞–µ—Ç –æ–±–µ –ø—Ä–æ–±–ª–µ–º—ã (–ø–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞)
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

–î–ª—è **MVP**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–í–∞—Ä–∏–∞–Ω—Ç 1 (–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)** –∫–∞–∫ –Ω–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—É—é –∏ –Ω–∞–¥–µ–∂–Ω—É—é.

–î–ª—è **–ü—Ä–æ–¥–∞–∫—à–µ–Ω–∞**: –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ **–í–∞—Ä–∏–∞–Ω—Ç 5 (–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥)** –ø–æ—Å–ª–µ MVP.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

1. –ò–∑—É—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `amplifyData` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
2. –ò–∑—É—á–∏—Ç—å –ª–∏–º–∏—Ç—ã –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `amplifyData`
3. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SSR/SSG –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
4. –ò–∑—É—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±–∞—Ç—á–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ GraphQL

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/app/(private)/grades/[gradeId]/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≥—Ä—É–ø–ø—ã
- `actions/grades.ts` - Server Action –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø—ã
- `src/lib/db/queries.ts` - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- `src/lib/db/amplify.ts` - GraphQL –∫–ª–∏–µ–Ω—Ç
- `src/lib/auth/cognito.ts` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

## –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫](../.cursor/plans/–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ_–æ—à–∏–±–æ–∫_–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏_–∏_–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö_–∑–∞–ø—Ä–æ—Å–æ–≤_e7ffcc78.plan.md)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ amplifyData –∏ –ª–∏–º–∏—Ç–∞–º](./AMPLIFY_DATA_AND_RATE_LIMITS.md)
- [–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö](./GRADE_PAGE_DATA_FETCHING.md)

