# Phase 14: Проверка домашних заданий (Homework Checks)

## Описание фазы
Реализация массовой проверки домашних заданий: таблица проверки для всех учеников группы, сохранение результатов, расчет баллов на основе настроек группы.

## Зависимости
Phase 13: Управление уроками (Lessons)

## Оценка времени
6-8 часов

## Требования к AI Agent

> [!IMPORTANT]
> - AI Agent при создании программного кода должен использовать актуальную документацию через Context7
> - Перед созданием кода необходимо проверять какой функционал NextJS поддерживается AWS Amplify
> - Следовать принципам из `docs/guidelines/prompts/general_prompt_guidelines.md`

## Задачи

### Task 14.01: Создание Server Actions для проверки ДЗ
- [ ] Создать `app/actions/homework.ts`
- [ ] Реализовать `createHomeworkCheck(input)` - создание проверки
- [ ] Реализовать `updateHomeworkCheck(input)` - обновление проверки
- [ ] Реализовать `bulkCreateHomeworkChecks(inputs)` - массовое создание проверок
- [ ] Реализовать `getHomeworkChecks(lessonId)` - получение проверок для урока
- [ ] Добавить проверку прав доступа

**Документация:**
- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - раздел Homework
- [VALIDATION.md](../../../api/VALIDATION.md) - раздел Homework Schemas
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.4 Проверка домашних заданий

**Критерии приемки:**
- Все Server Actions созданы
- Проверка прав доступа работает

---

### Task 14.02: Создание таблицы массовой проверки
- [ ] Создать Client Component `components/organisms/homework/homework-check-table.tsx`
- [ ] Реализовать таблицу со списком всех учеников группы
- [ ] Добавить чекбоксы для каждого параметра:
  - Золотые стихи
  - Оценка за тест
  - Оценка за тетрадь
  - Посещение спевки
- [ ] Показывать только включенные параметры (из настроек группы)
- [ ] Использовать компоненты Shadcn UI (Table, Checkbox)

**Документация:**
- [WIREFRAMES.md](../../../ui_ux/WIREFRAMES.md) - раздел Homework Check Table
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.4.1

**Критерии приемки:**
- Таблица создана
- Чекбоксы работают
- Параметры отображаются согласно настройкам

---

### Task 14.03: Реализация автоматического расчета баллов
- [ ] Создать утилиту `lib/utils/homework.ts`
- [ ] Реализовать функцию `calculatePoints(checks, gradeSettings)`:
  - Рассчитывает баллы на основе настроек группы
  - Учитывает включенные параметры
  - Возвращает общую сумму баллов
- [ ] Интегрировать расчет в форму проверки ДЗ

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.6.1 Система баллов
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.11.3 Настройка баллов

**Критерии приемки:**
- Расчет баллов работает
- Учитываются настройки группы
- Баллы рассчитываются автоматически

---

### Task 14.04: Реализация логики получения домика
- [ ] Реализовать функцию `calculateHouse(checks)`:
  - Проверяет, все ли параметры выполнены (все чекбоксы отмечены)
  - Возвращает true, если домик получен
- [ ] Интегрировать логику в форму проверки ДЗ
- [ ] Отобразить индикатор домика в таблице

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.6.2 Система домиков

**Критерии приемки:**
- Логика получения домика работает
- Индикатор отображается корректно

---

### Task 14.05: Создание страницы проверки ДЗ
- [ ] Создать `app/(private)/lessons/[lessonId]/homework-check/page.tsx`
- [ ] Реализовать Server Component для загрузки данных урока и учеников
- [ ] Интегрировать таблицу массовой проверки
- [ ] Добавить кнопку сохранения результатов
- [ ] Добавить обработку ошибок и loading state

**Документация:**
- [WIREFRAMES.md](../../../ui_ux/WIREFRAMES.md) - раздел Homework Check Page
- [USER_FLOW.md](../../../user_flows/USER_FLOW.md) - раздел Check Homework

**Критерии приемки:**
- Страница создана
- Таблица отображается
- Сохранение работает

---

### Task 14.06: Реализация сохранения результатов
- [ ] Реализовать массовое сохранение для всех учеников
- [ ] Реализовать частичное сохранение (можно сохранить часть и продолжить позже)
- [ ] Добавить валидацию данных перед сохранением
- [ ] Показать Toast уведомления об успехе/ошибке

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.4.1 Сохранение результатов
- [DESIGN_SYSTEM.md](../../../ui_ux/DESIGN_SYSTEM.md) - раздел Toast

**Критерии приемки:**
- Сохранение работает
- Частичное сохранение работает
- Уведомления показываются

---

### Task 14.07: Реализация редактирования проверки ДЗ
- [ ] Создать страницу редактирования проверки
- [ ] Загрузить существующие данные проверки
- [ ] Предзаполнить форму данными
- [ ] Обновить проверку через Server Action
- [ ] Обновить статус домика при изменении параметров

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.4.2 Редактирование проверки ДЗ
- [USER_FLOW.md](../../../user_flows/USER_FLOW.md)

**Критерии приемки:**
- Редактирование работает
- Данные предзаполняются
- Статус домика обновляется

---

### Task 14.08: Тестирование функционала проверки ДЗ
- [ ] Протестировать массовую проверку
- [ ] Протестировать расчет баллов
- [ ] Протестировать получение домика
- [ ] Протестировать сохранение результатов
- [ ] Протестировать редактирование проверки

**Критерии приемки:**
- Все тесты пройдены успешно
- Функционал работает корректно

---

## Ссылки на документацию проекта

- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - Homework Actions
- [VALIDATION.md](../../../api/VALIDATION.md) - Homework Schemas
- [WIREFRAMES.md](../../../ui_ux/WIREFRAMES.md) - Homework Pages
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.4

---

**Версия:** 1.0  
**Последнее обновление:** 23 декабря 2025

