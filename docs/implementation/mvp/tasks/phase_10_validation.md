# Phase 10: Создание системы валидации

## Описание фазы
Создание Zod схем валидации для всех сущностей, утилиты валидации, обработка ошибок валидации, интеграция с формами.

## Зависимости
Phase 09: Создание Data Access Layer

## Оценка времени
4-5 часов

## Требования к AI Agent

> [!IMPORTANT]
> - AI Agent при создании программного кода должен использовать актуальную документацию для конкретной версии библиотеки или фреймворка через Context7
> - Для Zod должна быть использована официальная документация
> - Перед созданием схем необходимо изучить VALIDATION.md документацию проекта
> - Следовать принципам из `docs/guidelines/prompts/general_prompt_guidelines.md`

## Задачи

### Task 10.01: Создание структуры валидации
- [ ] Создать каталог `lib/validation/`
- [ ] Создать файлы согласно [VALIDATION.md](../../../api/VALIDATION.md):
  - `lib/validation/index.ts` - реэкспорт всех схем
  - `lib/validation/auth.ts` - схемы аутентификации
  - `lib/validation/lessons.ts` - схемы уроков
  - `lib/validation/homework.ts` - схемы домашних заданий
  - `lib/validation/pupils.ts` - схемы учеников
  - `lib/validation/grades.ts` - схемы групп
  - И другие файлы согласно документации

**Документация:**
- [VALIDATION.md](../../../api/VALIDATION.md) - раздел 1.2 File Structure
- [COMPONENT_LIBRARY.md](../../../components/COMPONENT_LIBRARY.md)

**Критерии приемки:**
- Структура каталогов создана
- Все файлы созданы
- Структура соответствует документации

---

### Task 10.02: Создание базовых схем валидации
- [ ] Создать общие схемы в `lib/validation/common.ts`:
  - `uuidSchema` - валидация UUID
  - `dateSchema` - валидация даты
  - `emailSchema` - валидация email
  - `passwordSchema` - валидация пароля
  - И другие общие схемы
- [ ] Экспортировать схемы для использования

**Документация:**
- [VALIDATION.md](../../../api/VALIDATION.md) - раздел 2 Common Validation Patterns
- Zod документация (через Context7)

**Критерии приемки:**
- Базовые схемы созданы
- Схемы работают корректно
- Схемы экспортируются

---

### Task 10.03: Создание схем для аутентификации
- [ ] Создать схемы в `lib/validation/auth.ts`:
  - `signInSchema` - вход
  - `signUpSchema` - регистрация (если требуется)
  - И другие схемы аутентификации
- [ ] Использовать общие схемы (email, password)
- [ ] Добавить кастомные сообщения об ошибках

**Документация:**
- [VALIDATION.md](../../../api/VALIDATION.md) - раздел 3 Authentication Schemas
- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - раздел Auth Actions

**Критерии приемки:**
- Схемы аутентификации созданы
- Валидация работает корректно
- Сообщения об ошибках понятны

---

### Task 10.04: Создание схем для уроков
- [ ] Создать схемы в `lib/validation/lessons.ts`:
  - `createLessonSchema` - создание урока
  - `updateLessonSchema` - обновление урока
  - `lessonIdSchema` - валидация ID урока
- [ ] Использовать общие схемы где возможно
- [ ] Добавить валидацию для всех полей урока

**Документация:**
- [VALIDATION.md](../../../api/VALIDATION.md) - раздел 4 Lesson Schemas
- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - раздел Lesson Actions
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.3 Управление уроками

**Критерии приемки:**
- Схемы уроков созданы
- Валидация всех полей работает
- Схемы соответствуют требованиям MVP

---

### Task 10.05: Создание схем для других сущностей
- [ ] Создать схемы для групп (`grades.ts`)
- [ ] Создать схемы для учеников (`pupils.ts`)
- [ ] Создать схемы для домашних заданий (`homework.ts`)
- [ ] Создать схемы для других сущностей согласно [VALIDATION.md](../../../api/VALIDATION.md)
- [ ] Убедиться, что все схемы соответствуют GraphQL Schema

**Документация:**
- [VALIDATION.md](../../../api/VALIDATION.md) - все разделы
- [GRAPHQL_SCHEMA.md](../../../database/GRAPHQL_SCHEMA.md) - Input Types

**Критерии приемки:**
- Все схемы созданы
- Схемы соответствуют GraphQL Schema
- Валидация работает корректно

---

### Task 10.06: Создание утилит для обработки ошибок валидации
- [ ] Создать файл `lib/validation/utils.ts`
- [ ] Реализовать функцию `formatValidationErrors()`:
  - Преобразует Zod ошибки в понятный формат
  - Возвращает ошибки по полям
- [ ] Реализовать функцию `getFieldError()`:
  - Получает ошибку для конкретного поля
  - Возвращает сообщение об ошибке
- [ ] Экспортировать утилиты

**Документация:**
- [VALIDATION.md](../../../api/VALIDATION.md) - раздел 5 Error Handling
- Zod Error Handling документация (через Context7)

**Критерии приемки:**
- Утилиты созданы
- Форматирование ошибок работает
- Ошибки понятны пользователю

---

### Task 10.07: Интеграция с React Hook Form
- [ ] Убедиться, что `@hookform/resolvers` установлен
- [ ] Создать пример интеграции Zod с React Hook Form
- [ ] Создать утилиту для создания resolver из Zod схемы
- [ ] Протестировать интеграцию

**Документация:**
- [VALIDATION.md](../../../api/VALIDATION.md) - раздел 6 React Hook Form Integration
- React Hook Form Zod Resolver документация (через Context7)

**Критерии приемки:**
- Интеграция работает корректно
- Resolver создается из Zod схемы
- Валидация в формах работает

---

### Task 10.08: Тестирование схем валидации
- [ ] Протестировать все схемы с валидными данными
- [ ] Протестировать все схемы с невалидными данными
- [ ] Протестировать обработку ошибок
- [ ] Протестировать интеграцию с формами

**Документация:**
- [VALIDATION.md](../../../api/VALIDATION.md)
- Zod Testing документация (через Context7)

**Критерии приемки:**
- Все тесты пройдены успешно
- Валидация работает корректно
- Ошибки обрабатываются правильно

---

## Ссылки на документацию проекта

- [VALIDATION.md](../../../api/VALIDATION.md) - Все схемы валидации
- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - Использование валидации
- [GRAPHQL_SCHEMA.md](../../../database/GRAPHQL_SCHEMA.md) - Input Types

---

**Версия:** 1.0  
**Последнее обновление:** 23 декабря 2025

