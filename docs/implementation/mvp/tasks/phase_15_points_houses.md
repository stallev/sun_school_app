# Phase 15: Система баллов и домиков

## Описание фазы
Реализация системы баллов и домиков: автоматический расчет баллов на основе настроек группы, логика получения домика (все параметры выполнены), визуализация домиков.

## Зависимости
Phase 14: Проверка домашних заданий (Homework Checks)

## Оценка времени
4-5 часов

## Требования к AI Agent

> [!IMPORTANT]
> - AI Agent при создании программного кода должен использовать актуальную документацию через Context7
> - Следовать принципам из `docs/guidelines/prompts/general_prompt_guidelines.md`

## Задачи

### Task 15.01: Реализация логики расчета баллов
- [ ] Создать утилиту `lib/utils/points.ts`
- [ ] Реализовать функцию `calculateTotalPoints(homeworkChecks, gradeSettings)`:
  - Рассчитывает общую сумму баллов за все уроки
  - Учитывает настройки группы (баллы за каждый параметр)
  - Возвращает общую сумму
- [ ] Реализовать функцию `calculateAveragePoints(points, lessonsCount)`:
  - Рассчитывает средний балл
- [ ] Интегрировать расчет в компоненты

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.6.1 Система баллов
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.11.3 Настройка баллов

**Критерии приемки:**
- Расчет баллов работает
- Средний балл рассчитывается
- Учитываются настройки группы

---

### Task 15.02: Реализация логики получения домика
- [ ] Создать утилиту `lib/utils/houses.ts`
- [ ] Реализовать функцию `checkHouseEarned(homeworkCheck)`:
  - Проверяет, все ли параметры выполнены (все чекбоксы отмечены)
  - Возвращает true, если домик получен
- [ ] Реализовать функцию `countHouses(homeworkChecks)`:
  - Подсчитывает количество домиков за все уроки
- [ ] Интегрировать логику в проверку ДЗ

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.6.2 Система домиков

**Критерии приемки:**
- Логика получения домика работает
- Подсчет домиков работает

---

### Task 15.03: Создание визуализации домиков
- [ ] Создать компонент `components/molecules/house-icon.tsx`
- [ ] Реализовать визуальное отображение домика (иконка или изображение)
- [ ] Создать компонент `components/organisms/houses/house-display.tsx`:
  - Отображает количество домиков
  - Показывает визуализацию домиков
- [ ] Использовать иконки из lucide-react или кастомные изображения

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.5.4 Домики
- [DESIGN_SYSTEM.md](../../../ui_ux/DESIGN_SYSTEM.md) - раздел Iconography

**Критерии приемки:**
- Визуализация домиков создана
- Компоненты отображаются корректно

---

### Task 15.04: Интеграция с проверкой ДЗ
- [ ] Обновить форму проверки ДЗ:
  - Автоматически рассчитывать баллы при изменении чекбоксов
  - Автоматически определять получение домика
  - Отображать индикатор домика в таблице
- [ ] Сохранять информацию о домике при сохранении проверки ДЗ

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.4.1
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.6.2

**Критерии приемки:**
- Интеграция работает
- Баллы рассчитываются автоматически
- Домик определяется автоматически

---

### Task 15.05: Сохранение истории домиков
- [ ] Обновить Server Action создания проверки ДЗ:
  - Сохранять информацию о получении домика
  - Связывать домик с уроком и учеником
- [ ] Создать функцию для получения истории домиков ученика

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.5.4 Домики
- [DATA_MODELING.md](../../../database/DATA_MODELING.md)

**Критерии приемки:**
- История домиков сохраняется
- Можно получить историю домиков

---

### Task 15.06: Тестирование функционала баллов и домиков
- [ ] Протестировать расчет баллов
- [ ] Протестировать получение домика
- [ ] Протестировать визуализацию домиков
- [ ] Протестировать сохранение истории

**Критерии приемки:**
- Все тесты пройдены успешно
- Функционал работает корректно

---

## Ссылки на документацию проекта

- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.6 Система мотивации
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.5.4 Домики

---

**Версия:** 1.0  
**Последнее обновление:** 23 декабря 2025

