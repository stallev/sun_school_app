# Phase 12: Управление учебными годами (Academic Years)

## Описание фазы
Реализация управления учебными годами: создание, завершение, автоматическое определение активного года, блокировка создания уроков без активного года.

## Зависимости
Phase 11: Управление группами (Grades)

## Оценка времени
4-5 часов

## Требования к AI Agent

> [!IMPORTANT]
> - AI Agent при создании программного кода должен использовать актуальную документацию через Context7
> - Перед созданием кода необходимо проверять какой функционал NextJS поддерживается AWS Amplify
> - Следовать принципам из `docs/guidelines/prompts/general_prompt_guidelines.md`

## Задачи

### Task 12.01: Создание Server Actions для учебных годов
- [ ] Создать `app/actions/academicYears.ts`
- [ ] Реализовать `createAcademicYear(input)` - создание года (Admin only)
- [ ] Реализовать `updateAcademicYear(input)` - обновление года (Admin only)
- [ ] Реализовать `getActiveAcademicYear(gradeId)` - получение активного года группы
- [ ] Реализовать `listAcademicYears(gradeId)` - список годов группы
- [ ] Реализовать `completeAcademicYear(gradeId)` - завершение года (Admin only)
- [ ] Добавить проверку прав доступа

**Документация:**
- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - раздел Academic Years
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.2.2 Учебные годы

**Критерии приемки:**
- Все Server Actions созданы
- Проверка прав доступа работает

---

### Task 12.02: Реализация логики определения активного года
- [ ] Создать утилиту `lib/utils/academicYears.ts`
- [ ] Реализовать функцию `getActiveYear(gradeId)`:
  - Ищет год со статусом ACTIVE для группы
  - Возвращает активный год или null
- [ ] Использовать функцию в Server Actions и компонентах

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.2.2
- [DATA_MODELING.md](../../../database/DATA_MODELING.md)

**Критерии приемки:**
- Логика определения активного года работает
- Функция возвращает правильный год

---

### Task 12.03: Создание UI для управления учебными годами
- [ ] Создать страницу `app/(private)/grades/[gradeId]/academic-years/page.tsx`
- [ ] Отобразить список учебных годов группы
- [ ] Показать статус каждого года (ACTIVE, COMPLETED)
- [ ] Добавить кнопку создания нового года (Admin only)
- [ ] Добавить кнопку завершения активного года (Admin only)

**Документация:**
- [WIREFRAMES.md](../../../ui_ux/WIREFRAMES.md)
- [USER_FLOW.md](../../../user_flows/USER_FLOW.md)
- [TEACHER_FLOWS.md](../../../user_flows/TEACHER_FLOWS.md) - раздел 2.1 Вход в систему и навигация

**Критерии приемки:**
- UI создан
- Список годов отображается
- Действия работают

---

### Task 12.04: Реализация глобального завершения учебного года
- [ ] Реализовать Server Action `completeAllAcademicYears()` (Admin only)
- [ ] Завершить все активные учебные годы
- [ ] Изменить статус на COMPLETED
- [ ] Добавить UI для выполнения действия

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.12.1

**Критерии приемки:**
- Глобальное завершение работает
- Все активные годы завершены

---

### Task 12.05: Блокировка создания уроков без активного года
- [ ] Обновить Server Action `createLesson`:
  - Проверять наличие активного года перед созданием урока
  - Возвращать ошибку, если активного года нет
- [ ] Обновить UI создания урока:
  - Показывать сообщение, если активного года нет
  - Блокировать форму создания урока

**Документация:**
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.2.2 Бизнес-правило MVP
- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - раздел Lessons

**Критерии приемки:**
- Блокировка работает
- Сообщения понятны пользователю

---

### Task 12.06: Тестирование функционала учебных годов
- [ ] Протестировать создание учебного года
- [ ] Протестировать завершение года
- [ ] Протестировать определение активного года
- [ ] Протестировать блокировку создания уроков

**Критерии приемки:**
- Все тесты пройдены успешно
- Функционал работает корректно

---

## Ссылки на документацию проекта

- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - Academic Years Actions
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.2.2

---

**Версия:** 1.0  
**Последнее обновление:** 23 декабря 2025

