# Phase 11: Управление группами (Grades)

## Описание фазы
Реализация CRUD операций для групп (Grades): создание, редактирование, просмотр, удаление. Server Actions, UI компоненты, проверка прав доступа.

## Зависимости
Phase 10: Создание системы валидации

## Оценка времени
5-6 часов

## Требования к AI Agent

> [!IMPORTANT]
> - AI Agent при создании программного кода должен использовать актуальную документацию для конкретной версии библиотеки или фреймворка через Context7
> - Для Next.js 15.5.9 должна быть использована документация версии 15.5.9
> - Перед созданием кода необходимо проверять какой функционал NextJS поддерживается AWS Amplify. Это высокоприоритетное требование.
> - Следовать принципам из `docs/guidelines/prompts/general_prompt_guidelines.md`

## Задачи

### Task 11.01: Создание Server Actions для групп
- [ ] Создать `app/actions/grades.ts`
- [ ] Реализовать `createGrade(input)` - создание группы (Admin only)
- [ ] Реализовать `updateGrade(input)` - обновление группы (Admin only)
- [ ] Реализовать `deleteGrade(id)` - удаление группы (Admin only)
- [ ] Реализовать `getGrade(id)` - получение группы
- [ ] Реализовать `listGrades()` - список групп (Teacher видит только свои, Admin - все)
- [ ] Добавить проверку прав доступа в каждую функцию
- [ ] Использовать валидацию через Zod схемы

**Документация:**
- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - раздел Grades
- [VALIDATION.md](../../../api/VALIDATION.md) - раздел Grade Schemas
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.2.1 Группы

**Критерии приемки:**
- Все Server Actions созданы
- Проверка прав доступа работает
- Валидация работает корректно

---

### Task 11.02: Создание страницы списка групп
- [ ] Создать `app/(private)/grades/page.tsx` (для Admin)
- [ ] Создать `app/(private)/grades/my/page.tsx` (для Teacher - редирект на свою группу)
- [ ] Реализовать Server Component для отображения списка групп
- [ ] Использовать Data Access Layer для получения данных
- [ ] Добавить фильтрацию и поиск (если требуется)
- [ ] Добавить пагинацию (если требуется)

**Документация:**
- [WIREFRAMES.md](../../../ui_ux/WIREFRAMES.md) - раздел Grades List
- [USER_FLOW.md](../../../user_flows/USER_FLOW.md) - раздел Teacher/Admin flows
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.2.1

**Критерии приемки:**
- Страница списка групп создана
- Teacher видит только свои группы
- Admin видит все группы
- Данные загружаются корректно

---

### Task 11.03: Создание страницы просмотра группы
- [ ] Создать `app/(private)/grades/[gradeId]/page.tsx`
- [ ] Реализовать Server Component для отображения информации о группе
- [ ] Отобразить: название, описание, преподавателей, учеников, статистику
- [ ] Добавить кнопки действий: "Создать урок", "Настройки" (Admin), "Расписание"
- [ ] Использовать компоненты Shadcn UI (Card, Badge, Button)

**Документация:**
- [WIREFRAMES.md](../../../ui_ux/WIREFRAMES.md) - раздел Grade Detail
- [USER_FLOW.md](../../../user_flows/USER_FLOW.md) - раздел Grade View

**Критерии приемки:**
- Страница просмотра группы создана
- Вся информация отображается корректно
- Кнопки действий работают

---

### Task 11.04: Создание формы создания/редактирования группы
- [ ] Создать Client Component `components/organisms/grades/grade-form.tsx`
- [ ] Реализовать форму с полями: название, описание, minAge, maxAge
- [ ] Интегрировать с React Hook Form и Zod валидацией
- [ ] Добавить обработку ошибок
- [ ] Добавить loading state
- [ ] Использовать компоненты Shadcn UI (Form, Input, Button, Dialog)

**Документация:**
- [WIREFRAMES.md](../../../ui_ux/WIREFRAMES.md) - раздел Grade Form
- [VALIDATION.md](../../../api/VALIDATION.md) - раздел Grade Schemas
- [COMPONENT_LIBRARY.md](../../../components/COMPONENT_LIBRARY.md)

**Критерии приемки:**
- Форма создана
- Валидация работает
- Форма интегрирована с Server Actions

---

### Task 11.05: Реализация проверки прав доступа
- [ ] Создать утилиту `lib/utils/grades.ts` для проверки доступа к группе
- [ ] Реализовать функцию `checkGradeAccess(userId, gradeId)`:
  - Проверяет, имеет ли пользователь доступ к группе
  - Teacher может видеть только свои группы
  - Admin может видеть все группы
- [ ] Использовать утилиту в Server Actions и компонентах

**Документация:**
- [SECURITY.md](../../../infrastructure/SECURITY.md) - раздел RBAC
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.1.2 Роли пользователей

**Критерии приемки:**
- Проверка прав доступа работает
- Teacher ограничен своими группами
- Admin имеет доступ ко всем группам

---

### Task 11.06: Тестирование функционала групп
- [ ] Протестировать создание группы (Admin)
- [ ] Протестировать редактирование группы (Admin)
- [ ] Протестировать просмотр группы (Teacher и Admin)
- [ ] Протестировать проверку прав доступа
- [ ] Протестировать валидацию форм

**Документация:**
- [USER_FLOW.md](../../../user_flows/USER_FLOW.md) - раздел Grade Management

**Критерии приемки:**
- Все тесты пройдены успешно
- Функционал работает корректно
- Права доступа проверяются правильно

---

## Ссылки на документацию проекта

- [SERVER_ACTIONS.md](../../../api/SERVER_ACTIONS.md) - Grades Actions
- [VALIDATION.md](../../../api/VALIDATION.md) - Grade Schemas
- [WIREFRAMES.md](../../../ui_ux/WIREFRAMES.md) - Grade Pages
- [MVP_SCOPE.md](../../../MVP_SCOPE.md) - раздел 2.2.1

---

**Версия:** 1.0  
**Последнее обновление:** 23 декабря 2025

